import{_ as pe,A as ce,b as le,r as g,I as ae,J as ge,o as t,g as u,h as b,i as n,w as s,n as c,F as S,C as k,l as d,H as M,D as w,K as be,p as O,G as Y,L as Ve,M as Se,E as ke,d as xe,N as Ae,O as Ee,e as _e,P as Ie,Q as Ce,f as De,u as he,R as Te,S as me,T as Ue,U as Me,V as Oe,W as $e}from"./index.223d675f.js";/* empty css             *//* empty css              *//* empty css                     *//* empty css               */import{d as ue}from"./dayjs.min.c22e552c.js";const Ne=O("select file"),Pe=b("div",{class:"el-upload__tip text-red"}," limit 1 file, new file will cover the old file ",-1),Be=O("+"),Ye={class:"flex items-center"},je=O(" - "),ze=O(" Abort "),Re={__name:"AddTemplate",props:{inputData:{type:Object,default:()=>({})},showInput:{type:Array,default:()=>[]},showSelect:{type:Array,default:()=>[]},showMultiSelct:{type:Array,default:()=>[]},showSpecial:{type:String,default:""},selectItems:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1},showVersion:{type:Array,default:null}},emits:["data","abort"],setup(H,{emit:$}){const e=H,j={version:"",create_date:"",creator:"",download_path:"",status:0},{adminRules:J}=ce(le()),{fixError:x}=le(),z=g(null),r=g(ae(e.inputData)),W=g(),N=g([]),R=g(["version","download_path"]),Q=()=>{$("abort",!0)},oe=async i=>{r.value[e.showSpecial]=await Ve(i.raw)},se=()=>r.value[e.showSpecial]="",q=()=>{if(e.showSpecial&&!r.value[e.showSpecial]&&!e.isEdit){x({title:"Error",msg:"Need to upload Image!",isShow:!0});return}else if(N.value.filter(i=>i).length){x({title:"Error",msg:"Version detail Can't be empty!",isShow:!0});return}z.value.validate(async i=>{i?$("data",r.value):x({title:"Error",msg:"Some data cannot be empty!",isShow:!0})})},L=async i=>{W.value.clearFiles();const y=i[0];y.uid=Se(),W.value.handleStart(y)},ne=()=>{r.value[e.showVersion].push(ae(j)),N.value.push(!0)},X=i=>{r.value[e.showVersion].splice(i,1),N.value.splice(i,1)},re=i=>Object.values(r.value[e.showVersion][i]).filter(y=>y==="").length;return ge(r.value,()=>{!e.showVersion||r.value[e.showVersion].forEach((i,y)=>{N.value[y]=re(y)})}),(i,y)=>{const T=ke,V=xe,E=Ae,A=Ee,U=_e,I=Ie,Z=Ce,P=De;return t(),u(S,null,[b("main",null,[n(P,{"label-position":"left",ref_key:"formAction",ref:z,model:r.value,rules:d(J)},{default:s(()=>[c(" Input "),(t(!0),u(S,null,k(e.showInput,l=>(t(),u("div",{key:l},[n(V,{label:d(M)(l),style:{"margin-bottom":"30px",width:"40em"},class:"form-label",prop:l},{default:s(()=>[n(T,{type:l==="prefit"?"Number":"text",modelValue:r.value[l],"onUpdate:modelValue":h=>r.value[l]=h,autocomplete:"off"},null,8,["type","modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"])]))),128)),c(" Select "),(t(!0),u(S,null,k(e.showSelect,l=>(t(),u("div",{key:l},[n(V,{label:d(M)(l),style:{"margin-bottom":"30px",width:"40em"},class:"form-label",prop:l},{default:s(()=>[n(A,{modelValue:r.value[l],"onUpdate:modelValue":h=>r.value[l]=h,placeholder:"Select"},{default:s(()=>[(t(!0),u(S,null,k(e.selectItems[l],h=>(t(),w(E,{key:h.val,value:h.val,label:h.opt},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"])]))),128)),c(" Multi Select "),(t(!0),u(S,null,k(e.showMultiSelct,l=>(t(),u("div",{key:l},[n(V,{label:d(M)(l),style:{"margin-bottom":"30px",width:"40em"},class:"form-label",prop:l},{default:s(()=>[n(A,{modelValue:r.value[l],"onUpdate:modelValue":h=>r.value[l]=h,placeholder:"Select",multiple:""},{default:s(()=>[(t(!0),u(S,null,k(e.selectItems[l],h=>(t(),w(E,{key:h.val,value:h.val,label:h.opt},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"])]))),128)),c(" Image "),e.showSpecial?(t(),w(V,{key:0,label:d(M)(e.showSpecial),style:{"margin-bottom":"30px",width:"40em"},class:"form-label",prop:e.showSpecial},{default:s(()=>[n(I,{ref_key:"upload",ref:W,class:"upload-demo",limit:1,"on-exceed":L,"auto-upload":!1,accept:"image/jpg,image/jpeg,image/png,image/svg","on-remove":se,"on-change":oe,"list-type":"picture"},{trigger:s(()=>[n(U,{type:"primary"},{default:s(()=>[Ne]),_:1})]),tip:s(()=>[Pe]),_:1},512)]),_:1},8,["label","prop"])):c("v-if",!0),c(" Version "),e.showVersion?(t(),w(V,{key:1,label:"Version :",style:{"margin-bottom":"30px",width:"40em"},class:"form-label",prop:e.showVersion},{default:s(()=>[n(U,{onClick:ne},{default:s(()=>[Be]),_:1})]),_:1},8,["prop"])):c("v-if",!0),(t(!0),u(S,null,k(r.value[e.showVersion],(l,h)=>(t(),u("div",Ye,[n(U,{type:"danger",onClick:p=>X(h)},{default:s(()=>[je]),_:2},1032,["onClick"]),b("div",{class:be(["version-box",{"version-box-error":N.value[h]}])},[(t(!0),u(S,null,k(R.value,p=>(t(),w(V,{key:p,label:d(M)(p.replace("_"," ")),style:{"margin-bottom":"30px",width:"40em"},class:"form-label"},{default:s(()=>[n(T,{type:"text",modelValue:l[p],"onUpdate:modelValue":ie=>l[p]=ie,style:{width:"300px"},autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128)),n(V,{label:"Creator :",style:{"margin-bottom":"30px",width:"40em"},class:"form-label",props:l},{default:s(()=>[n(A,{modelValue:l.creator,"onUpdate:modelValue":p=>l.creator=p,placeholder:"Select"},{default:s(()=>[(t(!0),u(S,null,k(e.selectItems.creator,p=>(t(),w(E,{key:p.val,value:p.val,label:p.opt},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),n(V,{label:"Create Date :",style:{"margin-bottom":"30px",width:"40em"},class:"form-label",props:l},{default:s(()=>[n(Z,{modelValue:l.create_date,"onUpdate:modelValue":p=>l.create_date=p,type:"date",placeholder:"Pick a day",size:"default"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),n(V,{label:"Status :",style:{"margin-bottom":"30px",width:"40em"},class:"form-label",props:l},{default:s(()=>[n(A,{modelValue:l.status,"onUpdate:modelValue":p=>l.status=p,placeholder:"Select"},{default:s(()=>[(t(!0),u(S,null,k(e.selectItems.status,p=>(t(),w(E,{key:p.val,value:p.val,label:p.opt},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])],2)]))),256))]),_:1},8,["model","rules"])]),b("footer",null,[n(U,{class:"btn",onClick:q},{default:s(()=>[O(Y(e.isEdit?"Edit":"Add"),1)]),_:1}),e.isEdit?(t(),w(U,{key:0,class:"btn",onClick:Q},{default:s(()=>[ze]),_:1})):c("v-if",!0)])],64)}}},Le=pe(Re,[["__file","/Users/erichong/Desktop/WFH/partner-portal/src/components/AddTemplate.vue"]]);const Fe={class:"add-pop"},He={class:"flex justify-start items-center"},Je={class:"mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900"},We={__name:"Add",props:{title:{type:String,default:"EMPTY"},inputData:{type:Object,default:()=>({})},showInput:{type:Array,default:()=>[]},showSelect:{type:Array,default:()=>[]},showMultiSelct:{type:Array,default:()=>[]},showSpecial:{type:String,default:""},selectItems:{type:Object,default:()=>({})},showVersion:{type:Array,default:null}},emits:["data","abort"],setup(H,{emit:$}){const e=H,j=x=>{$("data",x)},J=x=>{$("abort",x)};return(x,z)=>{const r=Le;return t(),u("div",Fe,[b("header",He,[b("h1",Je,Y(e.title),1)]),n(r,{"input-data":e.inputData,"show-input":e.showInput,"show-select":e.showSelect,"show-multi-selct":e.showMultiSelct,"show-special":e.showSpecial,"select-items":e.selectItems,"show-version":e.showVersion,"is-edit":!0,onData:j,onAbort:J},null,8,["input-data","show-input","show-select","show-multi-selct","show-special","select-items","show-version"])])}}},Ge=pe(We,[["__scopeId","data-v-fa015b25"],["__file","/Users/erichong/Desktop/WFH/partner-portal/src/components/Add.vue"]]);const Qe={class:"w-full h-full flex flex-col items-center"},qe={class:"m-10"},Xe={key:0},Ze=["src"],Ke={key:0},et={key:0},tt={class:"mr-3"},lt=O("Edit"),at=O("Remove"),ot={class:"w-full h-1/12 flex justify-center items-center"},st=O("Create"),nt={__name:"EditTable",props:{routerType:{type:Number,default:0},path:{type:String,default:""},normalKeys:{type:Array,default:()=>[]},hasVersion:{type:Boolean,default:!1},hasImage:{type:Array,default:()=>[]},hasRemove:{type:Boolean,default:!1},title:{type:String,default:"EMPTY"},showInput:{type:Array,default:()=>[]},showSelect:{type:Array,default:()=>[]},showMultiSelct:{type:Array,default:()=>[]},showSpecial:{type:String,default:""},showVersion:{type:Array,default:null}},emits:["row"],setup(H,{emit:$}){const e=H,{creatorList:j,statusList:J,page_limit:x,isOpenAddPop:z}=ce(he()),{loginAdmin:r}=ce(le()),{loginAction:W}=le(),{fixPage_limit:N,getDataByPage:R,getEditData:Q,removeItem:oe,whichSelectOptionsShouldBeGet:se,fixLoading:q,fixOpenAddPop:L,addItem:ne,tableRowClassName:X}=he(),re=[{path:"admin",val:{name:"",permissions:1,company:"",status:0,account:"",password:"",email:"",last_login_time:""}},{path:"document",val:{name:"",document_type_id:"",version:[],prefit:[0]}},{path:"documentType",val:{name:""}},{path:"firmware",val:{name:"",version:[],prefit:[0]}},{path:"prefit",val:{name:"",prefit:0}},{path:"product",val:{name:"",production_type_id:"",photo:"",slogan:"",documents_id:[],firmware_id:[],prefit:[0]}},{path:"productionType",val:{name:"",photo:""}}],i=g(null),y=g(),T=g(),V=g(0),E=g({}),A=g([]),U=g({}),I=g(0),Z=g({}),P=g({}),l=a=>{i.value="E",E.value=a,L(!0)},h=async a=>{await oe(a,e.path,async()=>{await de("R",a)})},p=async a=>{const m=async()=>{await de(i.value,a),i.value=null,L(!1),console.log(z.value)};e.path==="admin"&&i.value==="A"&&(a.create_date=ue().format("YYYY-MM-DD HH:mm:ss"),a.action_log=[]),i.value==="A"&&await ne(a,e.path,m),i.value==="E"&&await Q(a,e.path,m)},ie=async(a,m)=>{let _={path:e.path,target:m._id,from:{},to:{}};if(a==="E"){const B=Object.keys(m);let F={},o={};for(let v=0;v<B.length;v++){const f=B[v];if(JSON.stringify(m[f])!==JSON.stringify(E.value[f]))if(f!=="version")F[f]=E.value[f],o[f]=m[f];else for(let ee=0;ee<m[f].length;ee++){const G=m[f][ee],te=E.value[f][ee];JSON.stringify(G)!==JSON.stringify(te)&&Object.keys(G).forEach(D=>{D==="version"?(F.ver_target=te[D],o.ver_target=G[D]):te[D]!==G[D]&&(F[D]=te[D],o[D]=G[D])})}}_.from=F,_.to=o}const K={time:ue().format("YYYY-MM-DD HH:mm:ss"),type:a,detail:_},C=ae(r.value.action_log);C.push(K),C.length>100&&C.shift(),await Q({action_log:C,_id:r.value._id},"admin",()=>{let B=ae(r.value);B.action_log=C,W(B),$("row",!0)},!1)},de=async(a,m)=>{const _=await R(V.value,e.path,!1,P.value);y.value=_.list,T.value=_.total,await ie(a,m)},fe=async a=>{V.value=a-1,y.value=(await R(V.value,e.path,!0,P.value)).list},ve=async a=>{N(a),y.value=(await R(0,e.path,!0,P.value)).list},we=()=>{I.value=e.normalKeys.length>=2?e.normalKeys.reduce((a,m)=>a.width+m.width):e.normalKeys[0].width,I.value+=A.value.length>=2?A.value.reduce((a,m)=>a.width+m.width):A.value[0]?A.value[0].width:0,e.hasImage.length&&(I.value+=e.hasImage[0].width),e.hasVersion&&(I.value+=260),I.value+=e.hasRemove?300:150,I.value>1440&&(I.value=1620)},ye=()=>{i.value="A",Z.value=re.find(a=>a.path===e.path).val,L(!0)};return Te(async()=>{if(e.path==="admin"&&r.value.permissions&&(P.value={permissions:[20,21]}),q(!0),e.routerType!==1e3){const a=await se(e.routerType);U.value=a.data,A.value=a.edit}we();try{const a=await R(0,e.path,!1,P.value);T.value=a.total,y.value=a.list}catch{y.value=[]}q(!1)}),(a,m)=>{const _=Me,K=Oe,C=_e,B=$e,F=Ge;return t(),u("div",Qe,[b("div",{class:"h-11/12 overflow-auto",style:Ue(`max-width: ${I.value}px`)},[n(K,{data:y.value,border:"","header-cell-style":{"text-align":"center"},"row-style":d(X)},{default:s(()=>[c(" Extend "),e.hasVersion?(t(),w(_,{key:0,type:"expand",class:"p-4"},{default:s(o=>[b("div",qe,[n(K,{data:o.row.version,style:{width:"1200px","margin-left":"0px"},"row-style":d(X)},{default:s(()=>[n(_,{width:"200",label:"Version",prop:"version"}),n(_,{width:"150",label:"Creator"},{default:s(v=>[b("div",null,[Object.keys(d(j)).length?(t(),u("span",Xe,Y(d(j).find(f=>f.val===v.row.creator).opt),1)):c("v-if",!0)])]),_:1}),n(_,{width:"200",label:"Create Date",prop:"create_date"}),n(_,{label:"Status",prop:"status",width:"120"},{default:s(v=>[b("span",null,Y(d(J).find(f=>f.val===v.row.status).opt),1)]),_:1}),n(_,{label:"Download Path",prop:"download_path","show-overflow-tooltip":!0})]),_:2},1032,["data","row-style"])])]),_:1})):c("v-if",!0),c(" Image "),(t(!0),u(S,null,k(e.hasImage,o=>(t(),w(_,{key:o,align:"center",prop:d(M)(o.key),label:o.key,width:o.width},{default:s(v=>[b("img",{class:"w-48 h-auto",src:v.row.photo,alt:""},null,8,Ze)]),_:2},1032,["prop","label","width"]))),128)),c(" Normal "),(t(!0),u(S,null,k(e.normalKeys,o=>(t(),w(_,{key:o.key,prop:o.key,label:d(M)(o.key),width:o.width,"show-overflow-tooltip":!0},null,8,["prop","label","width"]))),128)),c(" Specail List "),(t(!0),u(S,null,k(A.value,o=>(t(),w(_,{key:o.key,label:d(M)(o.key),prop:o.key,width:o.width,"show-overflow-tooltip":!0,sortable:""},{default:s(v=>[o.list.find(f=>f.val===v.row[o.key])?(t(),u("span",Ke,Y(o.list.find(f=>f.val===v.row[o.key]).opt),1)):c("v-if",!0)]),_:2},1032,["label","prop","width"]))),128)),c(" Version "),e.hasVersion?(t(),w(_,{key:1,prop:"version",label:"Version(version/date)",width:"200","show-overflow-tooltip":!0},{default:s(o=>{var v;return[(v=o.row.version)!=null&&v.length?(t(),u("div",et,[b("span",null,Y(o.row.version[0].version),1),b("span",tt," ("+Y(d(ue)(o.row.version[0].create_date).format("YYYY-MM-DD"))+") ",1)])):c("v-if",!0)]}),_:1})):c("v-if",!0),c(" Button "),n(_,{align:"center",label:"Action","max-width":e.hasRemove?300:150,"min-width":e.hasRemove?250:100},{default:s(o=>[n(C,{plain:"",type:"warning",size:"small",onClick:me(v=>l(o.row),["prevent"])},{default:s(()=>[lt]),_:2},1032,["onClick"]),e.hasRemove?(t(),w(C,{key:0,plain:"",type:"danger",size:"small",onClick:me(v=>h(o.row),["prevent"])},{default:s(()=>[at]),_:2},1032,["onClick"])):c("v-if",!0)]),_:1},8,["max-width","min-width"])]),_:1},8,["data","row-style"])],4),b("div",ot,[T.value?(t(),w(B,{key:0,background:"","page-sizes":[5,10,20,50],layout:"total,sizes,prev, pager, next",total:T.value,"page-count":Math.ceil(T.value/d(x)),"page-size":d(x),onSizeChange:ve,onCurrentChange:fe},null,8,["total","page-count","page-size"])):c("v-if",!0),n(C,{class:"ml-10",onClick:ye},{default:s(()=>[st]),_:1})]),d(z)?(t(),w(F,{key:0,title:i.value==="A"?e.title.replace("Edit","Add"):e.title,"input-data":i.value==="A"?Z.value:E.value,"show-input":e.showInput,"show-select":e.showSelect,"show-multi-selct":e.showMultiSelct,"show-special":e.showSpecial,"select-items":U.value,"show-version":e.showVersion,onAbort:m[0]||(m[0]=o=>d(L)(!1)),onData:p},null,8,["title","input-data","show-input","show-select","show-multi-selct","show-special","select-items","show-version"])):c("v-if",!0)])}}},mt=pe(nt,[["__scopeId","data-v-7d53c67a"],["__file","/Users/erichong/Desktop/WFH/partner-portal/src/components/EditTable.vue"]]);export{mt as E};
